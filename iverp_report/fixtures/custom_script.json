[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-05-13 10:41:54.871638", 
  "name": "Sales Invoice-Client", 
  "script": "/* 1 - - SET BRANCH BECOME READ ONLY IF DOCUMENT IS DRAFT or SAVED */\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\n{\nif(cur_frm.doc.name!=undefined && cur_frm.doc.amended_from==undefined ){\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",cur_frm.doc.__islocal ? 0 : 1);\ncur_frm.refresh_field('iverp_doc_location')\n}\n}\n});\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS SAVE OR DRAFT -- DONE 13MAY2018 */\n\n/* 1-2  - SET BRANCH BECOME READ ONLY IF DOCUMENT IS AMENDED FROM OTHER DOCUMENTS */\nfrappe.ui.form.on(\"Sales Invoice\", \"onload\", function(frm) { \n\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n\tcur_frm.doc.delivery_warehouse = cur_frm.doc.items[i].warehouse\n\t}\n\nif(cur_frm.doc.amended_from!=undefined )\n{\n\tcur_frm.doc.iverp_doc_location = cur_frm.doc.iverp_doc_location;\n\tcur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\n\tcur_frm.refresh_field('iverp_doc_location')\n}\n\n// Check if the branch was set before , for previous docs, if not, fetch from IVERP_DOC_LOCATION\n\nif(cur_frm.doc.amended_from !=undefined && cur_frm.doc.iverp_doc_location==undefined )\n{\n\t\n\nfrappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"IVERP_DOC_LOCATION\",\n               fieldname: \"branch_name\",\n               filters: { warehouse: cur_frm.doc.delivery_warehouse },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         cur_frm.doc.iverp_doc_location = res.message.branch_name\n\t\t\t cur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\t\t \n                         refresh_field(\"iverp_doc_location\");\n\t\t\t\n                  }\n              }      \n       });\n\n\t\n}\t\n\n\n});\n\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS AMENDED FROM  DONE 13 MAY 2018 */\n\n/* 1-2  - SET BRANCH BECOME READ ONLY IF DOCUMENT IS CREATED FROM SALES ORDER ( BRANCH SET BEFORE )- */\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) { \nif( cur_frm.doc.items[0].sales_order.length > 0 && cur_frm.doc.iverp_doc_Location !=undefined )\n{\n\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\ncur_frm.refresh_field('iverp_doc_location')\n\n}\n\n});\n\n\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS CREATED FROM SO -- DONE 13MAY2018*/\n\n\n/* 2-- UPDATE NAMING SERIES BASED ON BRANCH (IVERP_DOC_LOCATION) */\nfrappe.ui.form.on(\"Sales Invoice\", \"iverp_doc_location\", function(frm) { \nif(cur_frm.doc.iverp_doc_location!=undefined)\n{\n frappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"IVERP_DOC_LOCATION\",\n               fieldname: \"d_sales_invoice_s\",\n               filters: { branch_name: cur_frm.doc.iverp_doc_location },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         cur_frm.doc.naming_series = res.message.d_sales_invoice_s\t\t\t \n                         //refresh_field(\"naming_series\");\t\n                  }\n              }  \n       });\n\n}\n\n});\n\n// 2-1-UPDATE BRANCH IF CREATE FROM SALES ORDER AND FOLLOW SALES ORDER'S BRANCH -- something stucks 13may2018\n\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) { \nfor (var i =0; i < cur_frm.doc.items.length; i++){\nvar XYZ = cur_frm.doc.items[0].sales_order \n\n}\n\nif( XYZ !=undefined )\n{\n\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\n\n frappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"IVERP_DOC_LOCATION\",\n               fieldname: \"branch_name\",\n               filters: { warehouse: cur_frm.doc.delivery_warehouse },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         cur_frm.doc.iverp_doc_location = res.message.branch_name\n\t\t\t \t \n                         refresh_field(\"iverp_doc_location\");\n\t \t       \n\t\t\t\n\t\t\t\n                  }\n              }      \n       });\n\n/* frappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"IVERP_DOC_LOCATION\",\n               fieldname: \"d_sales_invoice_s\",\n               filters: { branch_name: cur_frm.doc.iverp_doc_location },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         \n\t\t\t cur_frm.doc.naming_series = res.message.d_sales_invoice_s\t\t \n                         \n\t \t        refresh_field(\"naming_series\");\n\t\t\t\n\t\t\t\n                  }\n              }      \n       });*/\n\n}\n\n});\n\ncur_frm.add_fetch('iverp_doc_location','d_sales_invoice_s','naming_series')\n\n/* END OF UPDATE BRANCH FOLLOW THE SALES ORDER BRANCH - DONE 12 MAY 2018 */\n\n/* 3-- FETCH DELIVERY WAREHOUSE BASED ON BRANCH */\n\ncur_frm.add_fetch('iverp_doc_location','warehouse','delivery_warehouse')\n\n//END FETCHING DELIVERY WAREHOUSE BASED ON BRANCH (IVERP_DOC_LOCATION)\n\n\n/* 4--FETCH COMPANY BASED ON BRANCH */\n\ncur_frm.add_fetch('iverp_doc_location','company','company')\n\n//END FETCHING COMPANY BASED ON BRANCH (IVERP_DOC_LOCATION)\n\n// 5--FETCH LETTER HEAD BASED ON BRANCH\n\ncur_frm.add_fetch('iverp_doc_location','letter_head','letter_head');\n\n//END FETCHING LETTER HEAD BASED ON DELIVERY WAREHOUSE\n\n\n// 6-- FETCH DELIVERY WAREHOUSE TO POPULATE TO ITEM LEVEL\n// 6-1 -- WHEN SELECT BRANCH UPDATE DELIVERY WAREHOUSE\n\n\nfrappe.ui.form.on(\"Sales Invoice\",\"iverp_doc_location\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n\n/* 6-1-2-UPDATE COST CENTER BASED ON BRANCH (IVERP_DOC_LOCATION) */\n\nfrappe.ui.form.on(\"Sales Invoice\", \"iverp_doc_location\", function(frm) { \nif( cur_frm.doc.iverp_doc_location !=undefined  ){\n  frappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"IVERP_DOC_LOCATION\",\n               fieldname: \"cost_center\",\n               filters: { branch_code: cur_frm.doc.iverp_doc_location },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         cur_frm.doc.cost_center = res.message.cost_center\n                         refresh_field(\"cost_center\");\n                  }\n              }      \n       });\n\n}\n});\n\n// POPULATE COST CENTER TO ITEM LEVEL\nfrappe.ui.form.on(\"Sales Invoice\",\"iverp_doc_location\", function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].cost_center = cur_frm.doc.cost_center\n  cur_frm.refresh_field('cost_center')\n  \n}\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].cost_center')\n\n\n});\n\n/* END OF UPDATE COST CENTER BASED ON BRANCH (IVERP_DOC_LOCATION) -- 11 MAY 2018 WIP */\n\n// 6-2 -- WHEN ADD ROW UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Invoice Item\",\"items_add\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n\n// 6-3 -- WHEN SAVE UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Invoice\",\"validate\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n\n// 6-3 -- WHEN ITEM CODE TRIGGER UPDATE DELIVERY WAREHOUSE\n\nfrappe.ui.form.on(\"Sales Invoice Item\",\"item_code\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n  \n \n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n\n\n\n//END FETCH DELIVERY WAREHOUSE TO POPULATE TO ITEM LEVEL\n\n// 8--FETCH REMARKS FROM SALES ORDER\nfrappe.ui.form.on('Sales Invoice', {\n\tonload: function(frm) {\n\t\tfrm.add_fetch(\"sales_order\", \"remark\", \"remark\");\n\t\t\n\t}\n});\n//END FETCH REMARKS FROM SALES ORDER\n\n//9 FETCH POS PROFILE TO UPDATE AT SALES INV\ncur_frm.add_fetch('iverp_doc_location','pos_profile','pos_profile');\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2018-05-13 08:13:06.715943", 
  "name": "Sales Order-Client", 
  "script": "/* 1 - - SET BRANCH BECOME READ ONLY IF DOCUMENT IS DRAFT or SAVED*/\n\nfrappe.ui.form.on(\"Sales Order\", \"refresh\", function(frm) {\n{\nif(cur_frm.doc.name!=undefined && cur_frm.doc.amended_from==undefined ){\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",cur_frm.doc.__islocal ? 0 : 1);\ncur_frm.refresh_field('iverp_doc_location')\n}\n}\n});\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS SAVE OR DRAFT -- DONE 13MAY2018 */\n\n// 1-2 SET BRANCH BECOME READ ONLY IF DOCUMENT IS SAVE OR DRAFT and Branch was Set\n\nfrappe.ui.form.on(\"Sales Order\", \"refresh\", function(frm) {\n{\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\", cur_frm.doc.__islocal ? 0 : 1);\n\n}\n});\n\n\n/* 1-2  - SET BRANCH BECOME READ ONLY IF DOCUMENT IS DRAFT AND BRANCH NOT SET BEFORE */\n// Check if the branch was set before , for previous docs, if not, fetch from IVERP_DOC_LOCATION\n\nfrappe.ui.form.on(\"Sales Order\", \"refresh\", function(frm) {\nif(cur_frm.doc.status ==\"Draft\" && cur_frm.doc.iverp_doc_location==undefined )\n{\t\n\nfrappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"IVERP_DOC_LOCATION\",\n               fieldname: \"branch_name\",\n               filters: { warehouse: cur_frm.doc.delivery_warehouse },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         cur_frm.doc.iverp_doc_location = res.message.branch_name\n\t\t\t cur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\t\t \n                         refresh_field(\"iverp_doc_location\");\n\t\t\t\n                  }\n              }      \n       });\n\n\t\n}\t\n\n\n});\n\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS DRAFT AND BRANCH NOT SET BEFORE- DONE 13 MAY 2018 */\n\n\n\n//SET BRANCH BECOME READ ONLY IF AMENDED_FROM OTHERS DOCUMENT\n\n// 1-2  - SET BRANCH BECOME READ ONLY IF DOCUMENT IS AMENDED FROM OTHER DOCUMENTS\n\nfrappe.ui.form.on(\"Sales Order\", \"onload\", function(frm) { \n\nif(cur_frm.doc.amended_from !=undefined && cur_frm.doc.iverp_doc_location==undefined) \n{\n// Check if the branch was set before , for previous docs.\n\nfrappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"IVERP_DOC_LOCATION\",\n               fieldname: \"branch_name\",\n               filters: { warehouse: cur_frm.doc.delivery_warehouse },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         cur_frm.doc.iverp_doc_location = res.message.branch_name\n\t\t\t cur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\t\t \n                         refresh_field(\"iverp_doc_location\");\n\t\t\t\n                  }\n              }      \n       });\n\n\t}\nelse if (cur_frm.doc.iverp_doc_location!=undefined && cur_frm.doc.iverp_doc_location!=undefined)\n\t{\n\tcur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\n\t\n\t}\n\n\n});\n\n\n\n\n\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS SAVE OR DRAFT */\n\n\n/* UPDATE NAMING SERIES BASED ON BRANCH (IVERP_DOC_LOCATION) */\n\nfrappe.ui.form.on(\"Sales Order\",\"onload\",\"iverp_doc_location\", function(frm){\n\ncur_frm.doc.naming_series = doc.iverp_doc_location.d_sales_order_s\ncur_frm.refresh_field('naming_series')\n\n\n\n});\n\ncur_frm.add_fetch('iverp_doc_location','d_sales_order_s','naming_series')\n\n\n//END FETCHING NAMING SERIES BASED ON BRANCH (IVERP_DOC_LOCATION)\n\n\n\n\n/* FETCH COMPANY BASED ON BRANCH */\nfrappe.ui.form.on(\"Sales Order\",\"iverp_doc_location\", function(frm){\n\n\ncur_frm.doc.company = doc.iverp_doc_location.company\ncur_frm.refresh_field('company')\n\n\n\n});\n\ncur_frm.add_fetch('iverp_doc_location','company','company')\n\n//END FETCHING COMPANY BASED ON BRANCH (IVERP_DOC_LOCATION)\n\n// FETCH LETTER HEAD BASED ON DELIVERY WAREHOUSE\n\nfrappe.ui.form.on(\"Sales Order\", \"delivery_warehouse\", function(frm) { \n  frappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"iverp_doc_location\",\n               fieldname: \"letter_head\",\n               filters: { warehouse: cur_frm.doc.delivery_warehouse },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         cur_frm.doc.letter_head = res.message.letter_head\n                          refresh_field(\"letter_head\");\n                  }\n              }      \n       });\n});\n\ncur_frm.add_fetch('iverp_doc_location','letter_head','letter_head');\n\n//END FETCHING LETTER HEAD BASED ON DELIVERY WAREHOUSE\n\n\n/* UPDATE COST CENTER BASED ON BRANCH (IVERP_DOC_LOCATION) */\n\nfrappe.ui.form.on(\"Sales Order\",\"onload\",\"iverp_doc_location\", function(frm){\n\ncur_frm.doc.cost_center = doc.iverp_doc_location.cost_center\ncur_frm.refresh_field('cost_center')\n\n\n\n});\n/* END OF UPDATE COST CENTER BASED ON BRANCH (IVERP_DOC_LOCATION) */\n\n\n//FETCH DELIVERY WAREHOUSE TO POPULATE TO ITEM LEVEL\n// 6-1 WHEN CHANGE BRANCH UPDATE WAREHOUSE\n\nfrappe.ui.form.on(\"Sales Order\",\"iverp_doc_location\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\ncur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n\n}\nalert(cur_frm.doc.delivery_warehouse);\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('delivery_warehouse')\n});\n\ncur_frm.add_fetch('iverp_doc_location','delivery_warehouse','delivery_warehouse')\n\n// 6 - 2 WHEN ADD ITEM UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Order Item\",\"items_add\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\ncur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('delivery_warehouse')\n});\n\n\n// 6-3 -- WHEN SAVE TRIGGER TO UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Order\",\"validate\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('delivery_warehouse')\n\n});\n\n// 6-4 -- WHEN KEY IN ITEM CODE TO TRIGGER UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Order Item\",\"item_code\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Receipt Item", 
  "modified": "2018-05-12 07:24:15.148262", 
  "name": "Purchase Receipt Item-Client", 
  "script": "frappe.ui.form.on(\"Purchase Receipt Item\",\"item_tax_rate_3\",function(frm){\n\nfrm.doc.item_tax_rate_4 = frm.doc.item_tax_rate_3.warehouse\n\nalert(item_tax_rate_3);\nalert(item_tax_rate_4);\n\n  cur_frm.doc.item_tax_rate = cur_frm.doc.item_tax_rate_3\n\ncur_frm.doc.item_tax_rate_2 = cur_frm.doc.item_tax_rate_3\ncur_frm.doc.item_tax_rate_4 = cur_frm.doc.item_tax_rate_3\n\ncur_frm.refresh_field('item_tax_rate')\ncur_frm.refresh_field('item_tax_rate_2')\ncur_frm.refresh_field('item_tax_rate_4')\n\n\n});", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Purchase Receipt", 
  "modified": "2018-05-12 07:27:00.244880", 
  "name": "Purchase Receipt-Client", 
  "script": "frappe.ui.form.on(\"Purchase Receipt\",\"item_tax_rate_3\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].item_tax_rate_4 = cur_frm.items[i].item_tax_rate_3\n}\n\nfrm.doc.item_tax_rate_4 = frm.doc.item_tax_rate_3.warehouse\n\nalert(item_tax_rate_3);\nalert(item_tax_rate_4);\n\n  cur_frm.doc.item_tax_rate = cur_frm.doc.item_tax_rate_3\n\ncur_frm.doc.item_tax_rate_2 = cur_frm.doc.item_tax_rate_3\ncur_frm.doc.item_tax_rate_4 = cur_frm.doc.item_tax_rate_3\n\ncur_frm.refresh_field('item_tax_rate')\ncur_frm.refresh_field('item_tax_rate_2')\ncur_frm.refresh_field('item_tax_rate_4')\n\n\n});", 
  "script_type": "Client"
 }
]