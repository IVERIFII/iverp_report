[
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Invoice", 
  "modified": "2018-05-07 05:02:38.450414", 
  "name": "Sales Invoice-Client", 
  "script": "// 8--FETCH REMARKS FROM SALES ORDER\nfrappe.ui.form.on('Sales Invoice', {\n\tonload: function(frm) {\n\t\tfrm.add_fetch(\"sales_order\", \"remark\", \"remark\");\n\t\t\n\t}\n});\n//END FETCH REMARKS FROM SALES ORDER\n\n/* 1 - - SET BRANCH BECOME READ ONLY IF DOCUMENT IS SAVE OR DRAFT */\nfrappe.ui.form.on(\"Sales Invoice\", \"refresh\", function(frm) {\n{\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\", cur_frm.doc.__islocal ? 0 : 1);\n\n}\n});\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS SAVE OR DRAFT */\n\n/* 1-2  - SET BRANCH BECOME READ ONLY IF DOCUMENT IS AMENDED FROM OTHER DOCUMENTS */\nfrappe.ui.form.on(\"Sales Invoice\", \"onload\", function(frm) { \nvar XYZ = cur_frm.doc.amended_from ;\t\t\n\t\nif( cur_frm.doc.amended_from.length > 0 )\n{\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\n//var DEF = \"Location Change!!!\" ;\n//alert(DEF);\n}\nelse\n{\n//var GGG = \"This document cannot change Location, it must be same location with Document : \" ;\n\n//alert(GGG + XYZ);\n//cur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\n//onfocus=\"this.value=''\"\n//window.history.back();\n}\n});\n\n/* 1-2  - SET BRANCH BECOME READ ONLY IF DOCUMENT IS CREATED FROM SALES ORDER */\nfrappe.ui.form.on(\"Sales Invoice\", \"onload\", function(frm) { \nif( cur_frm.doc.items[0].sales_order.length > 0  )\n{\nfor (var i =0; i < cur_frm.doc.items.length; i++){\nvar XYZ = cur_frm.doc.items[0].sales_order \n}\n}\t\t\n\nif( cur_frm.doc.items[0].sales_order.length > 0  )\n{\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\",true);\n\n\nvar DEF = \"You're creating Sales Invoice from Sales Order No. : \" ;\n//alert(DEF + XYZ);\n//var DEF = \"Location Change!!!\" ;\n//alert(DEF);\n}\n\n});\n\n\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS AMENDED FROM*/\n\n/* 2-- UPDATE NAMING SERIES BASED ON BRANCH (IVERP_DOC_LOCATION) */\n/*\nfrappe.ui.form.on(\"Sales Invoice\",\"iverp_doc_location\", function(frm){\n\nfrm.doc.naming_series = doc.iverp_doc_location.d_sales_invoice_s\ncur_frm.refresh_field('naming_series')\n\n\n\n});\n*/\n\ncur_frm.add_fetch('iverp_doc_location','d_sales_invoice_s','naming_series')\n\n/* END OF UPDATE NAMING SERIES BASED ON BRANCH (IVERP_DOC_LOCATION) */\n\n/* 3-- FETCH DELIVERY WAREHOUSE BASED ON BRANCH */\n/*frappe.ui.form.on(\"Sales Invoice\",\"iverp_doc_location\", function(frm){\n\n\ncur_frm.doc.delivery_warehouse = doc.iverp_doc_location.warehouse\ncur_frm.refresh_field('delivery_warehouse')\n\n\n\n});\n*/\ncur_frm.add_fetch('iverp_doc_location','warehouse','delivery_warehouse')\n\n//END FETCHING DELIVERY WAREHOUSE BASED ON BRANCH (IVERP_DOC_LOCATION)\n\n\n\n/* 4--FETCH COMPANY BASED ON BRANCH */\n/*frappe.ui.form.on(\"Sales Invoice\",\"iverp_doc_location\", function(frm){\n\n\ncur_frm.doc.company = doc.iverp_doc_location.company\ncur_frm.refresh_field('company')\n\n\n\n});\n*/\n\ncur_frm.add_fetch('iverp_doc_location','company','company')\n\n//END FETCHING COMPANY BASED ON BRANCH (IVERP_DOC_LOCATION)\n\n// 5--FETCH LETTER HEAD BASED ON BRANCH\n\ncur_frm.add_fetch('iverp_doc_location','letter_head','letter_head');\n\n//END FETCHING LETTER HEAD BASED ON DELIVERY WAREHOUSE\n\n\n// 6-- FETCH DELIVERY WAREHOUSE TO POPULATE TO ITEM LEVEL\n// 6-1 -- WHEN SELECT BRANCH UPDATE DELIVERY WAREHOUSE\n\n\nfrappe.ui.form.on(\"Sales Invoice\",\"iverp_doc_location\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n\n// 6-2 -- WHEN ADD ROW UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Invoice Item\",\"items_add\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n\n// 6-3 -- WHEN SAVE UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Invoice\",\"validate\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n\n// 6-3 -- WHEN ITEM CODE TRIGGER UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Invoice Item\",\"item_code\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n\n\n//cur_frm.add_fetch('iverp_doc_location','warehouse','warehouse');\n\n//END FETCH DELIVERY WAREHOUSE TO POPULATE TO ITEM LEVEL\n\n\n", 
  "script_type": "Client"
 }, 
 {
  "docstatus": 0, 
  "doctype": "Custom Script", 
  "dt": "Sales Order", 
  "modified": "2018-05-07 02:29:13.128049", 
  "name": "Sales Order-Client", 
  "script": "//SET BRANCH BECOME READ ONLY IF AMENDED_FROM OTHERS DOCUMENT\n\n/*\ncur_frm.cscript.custom_refresh = function(doc) {\n    cur_frm.set_df_property(\"iverp_doc_location\", \"read_only\", cur_frm.doc.amended_from !=\"\");\ncur_frm.refresh_field('iverp_doc_location');\n}\n*/\n\n/*\nfrappe.ui.form.on(\"Sales Order\", \"onload\", function(frm) {\nif(cur_frm.doc.amended_from != \"\"){\n       cur_frm.set_df_property(\"iverp_doc_location\", \"hidden\",true);\n       }\n\n});\n*/\n\n    \n\n\n\n\n/* SET BRANCH BECOME READ ONLY IF DOCUMENT IS SAVE OR DRAFT */\nfrappe.ui.form.on(\"Sales Order\", \"refresh\", function(frm) {\n{\ncur_frm.set_df_property(\"iverp_doc_location\", \"read_only\", cur_frm.doc.__islocal ? 0 : 1);\n\n}\n});\n/* END OF SET BRANCH BECOME READ ONLY IF DOCUMENT IS SAVE OR DRAFT */\n\n\n/* UPDATE NAMING SERIES BASED ON BRANCH (IVERP_DOC_LOCATION) */\n\nfrappe.ui.form.on(\"Sales Order\",\"onload\",\"iverp_doc_location\", function(frm){\n\ncur_frm.doc.naming_series = doc.iverp_doc_location.d_sales_order_s\ncur_frm.refresh_field('naming_series')\n\n\n\n});\n/* END OF UPDATE NAMING SERIES BASED ON BRANCH (IVERP_DOC_LOCATION) */\n\n//NAMING SERIES SET TO ZERO WHEN ONLOAD\nfrappe.ui.form.on(\"Sales Order\",\"onload\", function(frm){\n\ncur_frm.doc.naming_series = \"NULL\"\ncur_frm.refresh_field('naming_series')\n\n\n\n});\ncur_frm.add_fetch('iverp_doc_location','d_sales_order_s','naming_series')\n\n\n//END FETCHING NAMING SERIES BASED ON BRANCH (IVERP_DOC_LOCATION)\n\n\n\n\n/* FETCH COMPANY BASED ON BRANCH */\nfrappe.ui.form.on(\"Sales Order\",\"iverp_doc_location\", function(frm){\n\n\ncur_frm.doc.company = doc.iverp_doc_location.company\ncur_frm.refresh_field('company')\n\n\n\n});\n\ncur_frm.add_fetch('iverp_doc_location','company','company')\n\n//END FETCHING COMPANY BASED ON BRANCH (IVERP_DOC_LOCATION)\n\n// FETCH LETTER HEAD BASED ON DELIVERY WAREHOUSE\n\nfrappe.ui.form.on(\"Sales Order\", \"delivery_warehouse\", function(frm) { \n  frappe.call({\n           method: \"frappe.client.get_value\",\n           args: {\n               doctype: \"iverp_doc_location\",\n               fieldname: \"letter_head\",\n               filters: { warehouse: cur_frm.doc.delivery_warehouse },\n           },\n              callback: function(res){\n                 if (res && res.message){\n                         cur_frm.doc.letter_head = res.message.letter_head\n                          refresh_field(\"letter_head\");\n                  }\n              }      \n       });\n});\n\ncur_frm.add_fetch('iverp_doc_location','letter_head','letter_head');\n\n//END FETCHING LETTER HEAD BASED ON DELIVERY WAREHOUSE\n\n//FETCH DELIVERY WAREHOUSE TO POPULATE TO ITEM LEVEL\n// 6-1 WHEN CHANGE BRANCH UPDATE WAREHOUSE\n\nfrappe.ui.form.on(\"Sales Order\",\"iverp_doc_location\",function(frm, cdt, cdn){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\ncur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n\n}\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('delivery_warehouse')\n});\n\ncur_frm.add_fetch('iverp_doc_location','delivery_warehouse','delivery_warehouse')\n\n// 6 - 2 WHEN ADD ITEM UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Order Item\",\"items_add\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\ncur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n\n}\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('delivery_warehouse')\n});\n\n\n// 6-3 -- WHEN SAVE UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Order\",\"validate\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('delivery_warehouse')\n\n});\n\n// 6-4 -- WHEN ITEM CODE TRIGGER UPDATE DELIVERY WAREHOUSE\nfrappe.ui.form.on(\"Sales Order Item\",\"item_code\",function(frm){\nfor (var i =0; i < cur_frm.doc.items.length; i++){\n  cur_frm.doc.items[i].warehouse = cur_frm.doc.delivery_warehouse\n}\n\ncur_frm.refresh_field('items')\ncur_frm.refresh_field('cur_frm.doc.items[i].warehouse')\n\n});\n", 
  "script_type": "Client"
 }
]